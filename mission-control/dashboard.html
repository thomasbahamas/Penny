<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penny Mission Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon: #00f0ff; --accent: #ff6b35; --bg: #0a0a0f; --card: #12121a; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'SF Mono', monospace; }
        .neon { color: var(--neon); text-shadow: 0 0 10px var(--neon); }
        .accent { color: var(--accent); }
        .card { background: var(--card); border: 1px solid #222; border-radius: 12px; }
        .card:hover { border-color: var(--neon); transition: 0.3s; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .status-active { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
        .status-pending { background: #f59e0b; box-shadow: 0 0 8px #f59e0b; }
        .status-blocked { background: #ef4444; box-shadow: 0 0 8px #ef4444; }
        .scroll-container { max-height: 400px; overflow-y: auto; }
        .scroll-container::-webkit-scrollbar { width: 6px; }
        .scroll-container::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .tag { font-size: 10px; padding: 2px 8px; border-radius: 4px; background: #1a1a2e; }
    </style>
</head>
<body class="min-h-screen p-6">
    <!-- Header -->
    <header class="mb-8 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold neon">ü™ô PENNY MISSION CONTROL</h1>
            <p class="text-sm text-gray-500 mt-1">Last updated: <span id="last-updated">--</span></p>
        </div>
        <div class="flex gap-4">
            <button onclick="refreshData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-sm transition">
                üîÑ Refresh
            </button>
            <button onclick="openAddTask()" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm transition">
                + Add Task
            </button>
        </div>
    </header>

    <!-- Stats Row -->
    <div class="grid grid-cols-4 gap-4 mb-6">
        <div class="card p-4">
            <div class="text-gray-400 text-xs">Active Projects</div>
            <div class="text-2xl font-bold neon" id="active-count">0</div>
        </div>
        <div class="card p-4">
            <div class="text-gray-400 text-xs">Incomplete Tasks</div>
            <div class="text-2xl font-bold accent" id="incomplete-count">0</div>
        </div>
        <div class="card p-4">
            <div class="text-gray-400 text-xs">Blocked Items</div>
            <div class="text-2xl font-bold text-red-400" id="blocked-count">0</div>
        </div>
        <div class="card p-4">
            <div class="text-gray-400 text-xs">Completed Today</div>
            <div class="text-2xl font-bold text-green-400" id="completed-count">0</div>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-3 gap-6">
        
        <!-- Incomplete Column -->
        <div class="card p-4">
            <h2 class="font-bold text-lg mb-4 accent">üöß INCOMPLETE</h2>
            <div class="scroll-container space-y-3" id="incomplete-list">
                <div class="text-gray-500 text-sm">Loading...</div>
            </div>
        </div>

        <!-- Active Projects -->
        <div class="card p-4">
            <h2 class="font-bold text-lg mb-4 neon">‚ö° ACTIVE PROJECTS</h2>
            <div class="scroll-container space-y-3" id="active-list">
                <div class="text-gray-500 text-sm">Loading...</div>
            </div>
        </div>

        <!-- Blocked & Notes -->
        <div class="card p-4">
            <h2 class="font-bold text-lg mb-4 text-red-400">üî¥ BLOCKED / NOTES</h2>
            <div class="scroll-container space-y-3" id="blocked-list">
                <div class="text-gray-500 text-sm">Loading...</div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-800">
                <h3 class="text-xs text-gray-500 mb-2">QUICK NOTES</h3>
                <textarea id="quick-notes" class="w-full h-24 bg-black border border-gray-700 rounded p-2 text-xs text-gray-300" placeholder="Type notes here..."></textarea>
                <button onclick="saveNotes()" class="mt-2 w-full py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs">Save Note</button>
            </div>
        </div>
    </div>

    <!-- SKRmaxi Monitor -->
    <div class="card p-4 mt-6 border-l-4 border-cyan-500">
        <div class="flex justify-between items-center mb-4">
            <h2 class="font-bold text-lg neon">üì± SKRMAXI LIVE MONITOR</h2>
            <span id="skrmaxi-status" class="text-xs">Checking...</span>
        </div>
        <div class="grid grid-cols-4 gap-4 mb-4">
            <div class="bg-black/30 p-3 rounded">
                <div class="text-xs text-gray-500">Site Status</div>
                <div id="skrmaxi-site" class="text-lg font-bold">--</div>
            </div>
            <div class="bg-black/30 p-3 rounded">
                <div class="text-xs text-gray-500">Active Users</div>
                <div id="skrmaxi-users" class="text-lg font-bold text-cyan-400">--</div>
            </div>
            <div class="bg-black/30 p-3 rounded">
                <div class="text-xs text-gray-500">Response Time</div>
                <div id="skrmaxi-latency" class="text-lg font-bold">--</div>
            </div>
            <div class="bg-black/30 p-3 rounded">
                <div class="text-xs text-gray-500">Last Alert</div>
                <div id="skrmaxi-last-alert" class="text-xs text-gray-400">None</div>
            </div>
        </div>
        <div id="skrmaxi-alerts" class="space-y-2 max-h-32 overflow-y-auto scroll-container">
            <div class="text-xs text-gray-500">No alerts yet...</div>
        </div>
    </div>

    <!-- Agent Team Status -->
    <div class="card p-4 mt-6 border-l-4 border-purple-500">
        <h2 class="font-bold text-lg mb-4 text-purple-400">ü§ñ AGENT TEAM</h2>
        <div class="grid grid-cols-4 gap-3">
            <div class="bg-black/30 p-3 rounded border-l-2 border-cyan-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">ü¶û</span>
                    <span class="font-medium text-sm">PENNY</span>
                </div>
                <p class="text-xs text-gray-500">Orchestrator</p>
                <span class="tag text-green-400 text-xs">Active</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-pink-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">üé¨</span>
                    <span class="font-medium text-sm">NOVA</span>
                </div>
                <p class="text-xs text-gray-500">Video Production</p>
                <span class="tag text-gray-500 text-xs">Standby</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-green-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">üé®</span>
                    <span class="font-medium text-sm">PIXEL</span>
                </div>
                <p class="text-xs text-gray-500">Design</p>
                <span class="tag text-gray-500 text-xs">Standby</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-yellow-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">‚úçÔ∏è</span>
                    <span class="font-medium text-sm">SCRIBE</span>
                </div>
                <p class="text-xs text-gray-500">Copywriting</p>
                <span class="tag text-gray-500 text-xs">Standby</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-blue-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">üìä</span>
                    <span class="font-medium text-sm">ATLAS</span>
                </div>
                <p class="text-xs text-gray-500">Research</p>
                <span class="tag text-gray-500 text-xs">Standby</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-red-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">üåç</span>
                    <span class="font-medium text-sm">FED</span>
                </div>
                <p class="text-xs text-gray-500">Macro Investor</p>
                <span class="tag text-gray-500 text-xs">Standby</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-orange-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">‚ö°</span>
                    <span class="font-medium text-sm">SCALP</span>
                </div>
                <p class="text-xs text-gray-500">Crypto Trader</p>
                <span class="tag text-gray-500 text-xs">Standby</span>
            </div>
            <div class="bg-black/30 p-3 rounded border-l-2 border-indigo-500">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg">üîç</span>
                    <span class="font-medium text-sm">SENTINEL</span>
                </div>
                <p class="text-xs text-gray-500">Monitoring</p>
                <span class="tag text-green-400 text-xs">Active</span>
            </div>
        </div>
        <div class="mt-4 p-3 bg-black/20 rounded">
            <p class="text-xs text-gray-400">
                <span class="text-purple-400">üí°</span> Spawn agents via Telegram: 
                <code class="bg-gray-800 px-1 rounded">"Spawn NOVA for video research"</code>
            </p>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="card p-4 mt-6">
        <h2 class="font-bold text-lg mb-4">üìÖ RECENT ACTIVITY</h2>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <h3 class="text-xs text-gray-500 mb-2">TODAY'S MEMORY</h3>
                <div id="today-memory" class="text-sm text-gray-400 max-h-32 overflow-y-auto"></div>
            </div>
            <div>
                <h3 class="text-xs text-gray-500 mb-2">GIT ACTIVITY</h3>
                <div id="git-activity" class="text-sm text-gray-400 font-mono max-h-32 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script>
        let currentData = { incomplete: [], active: [], blocked: [], notes: '', gitActivity: [] };

        async function fetchData() {
            try {
                const res = await fetch('/api/data');
                currentData = await res.json();
                render();
            } catch (e) {
                console.error('Failed to fetch:', e);
                // Fallback to sample data
                currentData = {
                    incomplete: [
                        { title: "Context Retention System", desc: "FAISS + hourly summarizer", status: "active" },
                        { title: "SKRmaxi.com", desc: "Landing page + Telegram alerts", status: "active" },
                        { title: "Meme Coin Group", desc: "Multi-agent chat analysis", status: "pending" },
                    ],
                    active: [
                        { title: "SolanaFloor Content", desc: "Daily briefings + signals", last: "2h ago" },
                        { title: "Mission Control Dashboard", desc: "This dashboard", last: "now" },
                    ],
                    blocked: [
                        { title: "Grok Provider", desc: "XAI_API_KEY needed from x.ai/api", workaround: "Use Kimi for now" },
                        { title: "Python FAISS deps", desc: "Apt install taking long", workaround: "Use SQLite + simple search" },
                    ],
                    notes: "SKRMaxi is NOT a token site. It's the Seeker phone optimizer app.",
                    gitActivity: []
                };
                render();
            }
        }

        function render() {
            document.getElementById('last-updated').textContent = new Date().toLocaleString();
            document.getElementById('active-count').textContent = currentData.active.length;
            document.getElementById('incomplete-count').textContent = currentData.incomplete.length;
            document.getElementById('blocked-count').textContent = currentData.blocked.length;
            document.getElementById('completed-count').textContent = '2';

            // Render incomplete
            document.getElementById('incomplete-list').innerHTML = currentData.incomplete.length 
                ? currentData.incomplete.map(item => `
                    <div class="p-3 bg-black/30 rounded border-l-2 ${item.status === 'active' ? 'border-green-500' : 'border-yellow-500'}">
                        <div class="flex justify-between items-start">
                            <span class="font-medium text-sm">${item.title}</span>
                            <span class="tag ${item.status === 'active' ? 'text-green-400' : 'text-yellow-400'}">${item.status}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">${item.desc}</p>
                    </div>
                `).join('')
                : '<div class="text-gray-500 text-sm">No incomplete tasks</div>';

            // Render active
            document.getElementById('active-list').innerHTML = currentData.active.length
                ? currentData.active.map(item => `
                    <div class="p-3 bg-black/30 rounded border-l-2 border-cyan-500">
                        <div class="flex justify-between items-start">
                            <span class="font-medium text-sm">${item.title}</span>
                            <span class="tag text-cyan-400">${item.last || 'active'}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">${item.desc}</p>
                    </div>
                `).join('')
                : '<div class="text-gray-500 text-sm">No active projects</div>';

            // Render blocked
            document.getElementById('blocked-list').innerHTML = currentData.blocked.length
                ? currentData.blocked.map(item => `
                    <div class="p-3 bg-black/30 rounded border-l-2 border-red-500">
                        <div class="font-medium text-sm text-red-300">${item.title}</div>
                        <p class="text-xs text-gray-500 mt-1">${item.desc}</p>
                        ${item.workaround ? `<p class="text-xs text-green-400 mt-1">üí° ${item.workaround}</p>` : ''}
                    </div>
                `).join('')
                : '<div class="text-gray-500 text-sm">No blocked items</div>';

            // Update notes and git
            document.getElementById('quick-notes').value = currentData.notes || '';
            document.getElementById('today-memory').textContent = currentData.notes?.substring(0, 200) || 'No notes';
            document.getElementById('git-activity').innerHTML = currentData.gitActivity
                ?.slice(0, 5).map(g => `<div>${g}</div>`).join('') || 'No git activity';
            
            // Render SKRmaxi data
            renderSkrmaxi();
        }
        
        function renderSkrmaxi() {
            if (!currentData.skrmaxi) {
                document.getElementById('skrmaxi-status').textContent = 'No data yet';
                return;
            }
            
            const skr = currentData.skrmaxi;
            const results = skr.results || [];
            
            // Overall status
            const allUp = results.every(r => r.status === 'up');
            document.getElementById('skrmaxi-status').innerHTML = allUp 
                ? '<span class="text-green-400">‚óè Online</span>' 
                : '<span class="text-red-400">‚óè Issues</span>';
            
            // Site status
            const health = results.find(r => r.name === 'health');
            document.getElementById('skrmaxi-site').innerHTML = health 
                ? (health.status === 'up' ? '<span class="text-green-400">UP</span>' : '<span class="text-red-400">DOWN</span>')
                : '<span class="text-gray-500">--</span>';
            
            // Users from stats
            const stats = results.find(r => r.name === 'stats');
            const users = stats?.data?.active_users || stats?.data?.total_wallets || '--';
            document.getElementById('skrmaxi-users').textContent = users;
            
            // Latency
            const avgLatency = results.filter(r => r.latency_ms).reduce((a, b) => a + b.latency_ms, 0) / results.filter(r => r.latency_ms).length || 0;
            document.getElementById('skrmaxi-latency').innerHTML = avgLatency 
                ? `<span class="${avgLatency < 1000 ? 'text-green-400' : avgLatency < 3000 ? 'text-yellow-400' : 'text-red-400'}">${Math.round(avgLatency)}ms</span>`
                : '--';
            
            // Last check time
            document.getElementById('skrmaxi-last-alert').textContent = new Date(skr.timestamp).toLocaleTimeString();
            
            // Alerts list
            const issues = results.filter(r => r.status !== 'up');
            document.getElementById('skrmaxi-alerts').innerHTML = issues.length
                ? issues.map(i => `
                    <div class="p-2 bg-red-900/20 rounded text-xs">
                        <span class="text-red-400">üî¥ ${i.name}:</span> ${i.error || i.status}
                    </div>
                `).join('')
                : '<div class="text-xs text-green-400">‚úì All systems operational</div>';
        }

        async function refreshData() {
            await fetchData();
        }

        function saveNotes() {
            currentData.notes = document.getElementById('quick-notes').value;
            alert('Notes saved! (In real version, writes to memory file)');
        }

        function openAddTask() {
            const title = prompt('Task title:');
            if (title) {
                currentData.incomplete.push({
                    title,
                    desc: 'New task',
                    status: 'pending'
                });
                render();
            }
        }

        // Initial fetch
        fetchData();
        
        // Auto-refresh every 60 seconds
        setInterval(fetchData, 60000);
    </script>
</body>
</html>
